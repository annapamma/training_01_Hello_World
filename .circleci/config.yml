version: 2.1

# PR on branch_a waits
# branch_a creates branch_a_e2e_tests and triggers pipeline with api on branch_a_e2e_tests
# branch_a_e2e_tests pipeline runs
# This way the pipeline is not triggered on branch_b

jobs:
  build:
    docker:
      - image: node:9.6.1
    steps:
      - add_ssh_keys:
          fingerprints:
            - "af:13:32:f8:a1:a3:4b:ea:d7:3e:56:16:ae:ab:1e:bb"
      - checkout
      - run: git checkout -b "e2e_tests_${CIRCLE_SHA1}"
      - run: git config --global user.email "anna.pamela@gmail.com"
      - run: git config --global user.name "Anna"
      - run: git commit --allow-empty -m "test"
      - run: git push -u origin "e2e_tests_${CIRCLE_SHA1}"
  other-job-1:
    docker:
      - image: node:9.6.1
    steps:
      - add_ssh_keys:
          fingerprints:
            - "af:13:32:f8:a1:a3:4b:ea:d7:3e:56:16:ae:ab:1e:bb"
      - checkout
      - run: git config --global user.email "anna.pamela@gmail.com"
      - run: git config --global user.name "Anna"
      - run: exit 0
      - run: git checkout master
      - run: git branch -d "${CIRCLE_BRANCH}"
      - run: git branch -dr "origin/${CIRCLE_BRANCH}"

workflows:
  build-wf:
    jobs:
      - build:
          filters:
            branches:
              ignore:
                - /e2e_tests.*/
  other-wf:
      jobs:
        - other-job-1:
            filters:
              branches:
                only:
                  - /e2e_tests.*/
