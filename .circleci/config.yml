version: 2.1

commands:
  use-credentials:
    steps:
      - attach_workspace:
          at: /tmp/workspace
      - run: cat /tmp/workspace/credentials

jobs:
 one:
    docker:
      - image: circleci/ruby:2.4.1
    steps:
      - run: mkdir -p /tmp/workspace
      - run: echo "Credentials!" > /tmp/workspace/credentials
      - persist_to_workspace:
          root: /tmp/workspace
          paths:
            - credentials
 two_a:
    docker:
      - image: circleci/ruby:2.4.1
    steps:
      - use-credentials
 two_b:
    docker:
      - image: circleci/ruby:2.4.1
    steps:
      - attach_workspace:
          at: /tmp/workspace
      - run: cat /tmp/workspace/credentials
 two_c:
    docker:
      - image: circleci/ruby:2.4.1
    steps:
      - attach_workspace:
          at: /tmp/workspace
      - run: cat /tmp/workspace/credentials

workflows:
 demo-workspace:
   jobs:
     - one
     - two_a:
         requires:
           - one
     - two_b:
         requires:
           - one
     - two_c:
         requires:
           - one
